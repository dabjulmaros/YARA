<script>
	import { localStore } from '$lib/utils/storable';
	import { searchCleaner } from '$lib/utils/searchCleaner';

	export let noMargin;
	export const submitSearch = () => formSubmit();
	export let inputField;

	let element;

	function formSubmit() {
		let cleanInputField = searchCleaner(inputField, $localStore.method, true);
		window.location = cleanInputField;
	}

	function keyDown(e) {
		if (e.keyCode == 13) {
			formSubmit();
		}
	}
	function textDrop(e) {
		e.preventDefault();
		let textData = e.dataTransfer.getData('text'); // get the dragged value
		e.target.value = textData; // change the value with the new value
		inputField = textData;
		formSubmit();
	}
	function input(element) {
		if (element.target) {
			element = element.target;
		}
		if (inputField == '') {
			element.className = 'home';
		} else if (inputField.substring(0, 2) == 'u/') {
			element.className = 'person';
		} else if (
			inputField.substring(0, 1) == '?' ||
			inputField.includes('search') ||
			inputField.includes('Search')
		) {
			element.className = 'search';
		} else if (inputField.includes('/comments/')) {
			element.className = 'post';
		} else {
			element.className = 'community';
		}
	}
</script>

<input
	type="search"
	class="home"
	id="searchBar"
	placeholder="Enter Sub name... no r/ needed"
	bind:value={inputField}
	on:keydown={keyDown}
	on:drop={textDrop}
	on:input={input}
	bind:this={element}
	use:input
	style={`max-width:600px;${noMargin ? 'margin:0' : ''}`}
/>

<style>
	/* home */
	:global(input[type='search']#searchBar) {
		background-size: 25px;
		background-position-x: 16px;
	}
	:global(input[type='search'].home) {
		background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAAvlJREFUaEPtmTFoE1EYx//fJRpFoXXp4CCIkzhE06JtIkKwuQ6iDoJQ0IIgXQQpCF1EoYiDQqEILsGpFgKCg27NVbI0iUqT2qGz4NipmWo0uU9OItSY5r3cvTuP5mW9933v+33/917+947QZz/qM15o4P2uuFZYK7zPOvBflvTK6lra6eP4xZFC0P0MHDhfqtwj0FMHlMEPzeTwyyChAwW2ytUnYDwAcLgFuQPCfGYs8Sgo6ECAC4VCtBkbXGDwNIADbXA/CZSN1Ldn0ul0w29w34Ed2MbBgSUQbgCI7gHUAONt9Eftlt/QvgIvFzeGDGouAjABoatjAHmbI1MTqfiWX0r7Brz8aeOk0bRzAJ+XgP3DxwB9tiPG5MSF+Fc/oH0B/lBeSzTZWCTgjJuiGdiMkD11eWyk6ia+W4xy4JWP6xm2+RWAEx6L/UYG3R0fPWd5zPNXuFLgfKk6ScACgCFFRW4xMGMmEzlF+YQHifQ8uwzFgHSQ3MCaSoOiROEOhkIORX6UMoPiCVhgKORx5EYqMSiugSUNhRyK/CjPBsUVcKGwebQRqy8BuArAkK9XyUhPBqVn4JZ7egPgUg+GQgnpriSuDUpPwFa5cppsyjEhrprATT43BkUa2FqtjMIgZxmfclOcjzE9GRQpYKu4fgXEWQDHfSzcS2ppgyIEtoqVO0Q0z8AxLxUFECtlULoC58uVWWJ6DOBIAAWrmGKHGXNmKvFsr2R7AlulynOA7gOIqagkwBx1gF9kksOzneb8B/i3oTg0mAXz7S43FAHW72qqBoheR79vT7ffoAj3cPt0VrH6DoRrrspQHcR4n0klrveSVgOLuqUVFnXIz+d6SYu7G8QerjEbN83U2Xy3cvLFLyaR7byUyN+YhFRhDdxJaa2weDs6nx9D+T+sl7Re0s5XNH1KS2xivYfFTdLGQ9QjFy8P+pTWp7Q+pUUbq/Vcn9LiRvV8SotThnuEBg63Pt6r0wp772G4M2iFw62P9+q0wt57GO4MfafwLwd7zkx3miySAAAAAElFTkSuQmCC);
	}
	/* search */
	:global(input[type='search'].search) {
		background-image: url(data:image/png;base64,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);
	}
	/* person */
	:global(input[type='search'].person) {
		background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAA4FJREFUaEPtmU1oVFcUx3/3ztQPKgZdZCFisBRcdGGcBCQz2YxxJtDYulFpqXVrixCQguguO0FQQRBxJ4rYajdGVDI2DpRkbKmdRqSICxGlFOqiMIJoYuYeeclYxqjMnXn3DtPMe+tzzzm/+z/36zxFm32qzXiJgBe74pHCkcKLbAaikl5kgr6FEynsQ+GxX++s12VzEGQI6AQ+qMSZBf5RwnXRcizT13PPR/xqn14Vzufz8dmlKw+D2gcsrwHzHOFMfKY0nE6ng4nw8nkDHpu806lV+SyQBesbnQA/G4ntGkxtfOKD2AvwvLIdPwKf1wH7mi+AHo1Pl3b4UNoLcG6yeFQphoF4gyrNinAim0p81+D49w5zDjxe+CNpkEvAmpDJ/q1ROweSmwoh/bwx3DlwRd39DZTyQq6gtE9nkolvWxr4RqH4G9DrKMlifLq02eVadqrwzYmpT8raXAW6HAE/ihk9tKW/+09H/qyPC6t4ucmprFLmItBhNaC2UUlE78qmunO1Te0snCqcKxQHNFwSWGUXvqZVawN7KOnHYLZlkr13a06NpYFThYOYbbVpVYBPAXvb5lj6aeJ2WrT+vvIqsiy0d5o9UcZ8sbW/Nx/GycKxzks6CODiaolwKpNKBNdTp58X4LZ7PASShHge5ozE9vyvnoeva7CqAfANsKJGbT4HORmffnrI5VWyKWt4YZBA7ZguHxBhO7AWWFaxeQH8pRSXyyZ2xJeq1fl4WcNOdxnHziJgxxPacu4ihVtOEscJeVN4fLLYZVBZ0bJFiWwAtQ5kCagPAV3hMCDPQM2APBal7iujbmokN5BKPHLMOufOGfDcmbukYzuKr4F+YHUI/0E/619gAuFcfKZ02dXZHBq40qU8AKSBlT5UAZ4CeY06EraL2TDw2K3fP9OiRoDuqhL1xPufWwNMGSUjg309VxoJVjfw/I+x8nHg06qfYo3EDjPmJXDNxGL7BzdvfFiPo7qAx2/dThjRPwAf1xPEo+0DjOzO9Pf8YhvDGni+X1UeBfWRrfMm2T3UyuwY6Ost2sSzBr5RKJ4Hvgyx89rk04hNsKNfyCQTX9kMtgL20I20ya0eG+uGvRWwhwZ7PTA2ttb96wj4XdMZKWxTZM21iUr6ffMdreHmVmLzo1kp3Py0/EWMgP3NbWt4jhRuDR38ZREp7G9uW8NzpHBr6OAvi1eoG1FMllYO9gAAAABJRU5ErkJggg==);
	}
	/* public */
	:global(input[type='search'].community) {
		background-image: url(data:image/png;base64,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);
	}
	/* forum */
	:global(input[type='search'].post) {
		background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAAmpJREFUaEPtm7FLG3EUx7+/U3ASnQpCSxUcBJdycUmuUKTeLYIOQp0LInQoHbp0d2n/AIubQwsFKVKdNCJZzOBgtJODk4tD0aFBCm2aPPnZgmdyuZx3P3+X/PKy5t57v8/7vvd+v7tcBLrsI7qMFwxsuuKssFR4p3g4DUEfATwCUi/73yB86/3TtzA5OX6ZtAIbFN4tlh7XBLYAjCV1rtC+SgLLXtZ+k9RnA3C+eOQJUVsDMJDUuVJ7wqbr2LNJfTIwK5y0hlTZc0nHyyT3MPdwvMpRb8U9LE+EpQ0IzARk94wI7zzH/lT/XUf3cAiw5DyxCO5zxz71Q5sM/JPIeuE5T/IM7M9AJ03pFiXNCkthuYe5pNUfIeJ5DDh4cA/fTiUPLR5aMgM8tOKNGPVWPLRC75Zkwjt8aAHrbs6e85eOydvSBQQtutnMenrAhHMIbAL4pb5hbzwSUVlY+OxmM8f1cXQq/AOCXtVn/D7Bg3zrAg4sL92wMp4O4LaB1QHcVrD3DdwAm98rTVgWPhDQn0Y5/4/5EMBQk/ix9+ELAl57OftLRzwKullkLOBA2LY+c8cFFkCNiN66TmY1qGTa9iYjJvAKiJaawRql8Pb+95GeSmV46ulEIWwYGaNw1IkrE2NVq/Kp/mhUG83XRRtad1nUTvHgJYR4D+DBXew0XaseWNPCb4UpFAq9f/sGvgLXvxqGvVhnBrCkjwhtDnBEaLOAI0CbB9wC2kzgEGhzgZtAmw0cAF2O9MpDGnurypi+LesZkTXf8h0PlcHT8vUPenCZQGtezt71r4P/ApCWKrrissK6Mp1WnK5T+ArI/G5bm/5mlQAAAABJRU5ErkJggg==);
	}
</style>
